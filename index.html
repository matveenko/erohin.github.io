<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Dr. Boris Erokhin | Knowledge Base</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* --- LIGHT THEME (Default) --- */
            --bg-body-start: #F0F4F8; 
            --bg-body-end: #FFFFFF;
            --bg-card: #FFFFFF;
            --text-main: #102A43;
            --text-sec: #627D98;
            --input-bg: #FFFFFF;
            --input-border: #D9E2EC;
            --tag-bg: #FFFFFF;
            --tag-border: #D9E2EC;
            --sheet-handle: #D9E2EC;
            --related-bg: #F5F7FA;
            --related-active: #E3F2FD;
            --accent-main: #007AFF;
            --accent-deep: #102A43;
            --accent-light: #E3F2FD;
            --shadow: 0 8px 24px rgba(16, 42, 67, 0.08);
            --toggle-bg: #FFFFFF;
            --toggle-icon: #007AFF;
            --toggle-shadow: 0 2px 8px rgba(0,0,0,0.05);
            --highlight-bg: rgba(255, 215, 0, 0.4);
        }

        /* --- DARK THEME OVERRIDES --- */
        [data-theme="dark"] {
            --bg-body-start: #0f172a; 
            --bg-body-end: #1e293b;
            --bg-card: #1e293b;
            --text-main: #F1F5F9;
            --text-sec: #94A3B8;
            --input-bg: #334155;
            --input-border: #475569;
            --tag-bg: #1e293b;
            --tag-border: #475569;
            --sheet-handle: #475569;
            --related-bg: #334155;
            --related-active: #475569;
            --accent-main: #60A5FA;   
            --accent-deep: #F8FAFC;   
            --accent-light: #1e293b; 
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            --toggle-bg: #1e293b;
            --toggle-icon: #FFD700;
            --toggle-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            --highlight-bg: rgba(255, 215, 0, 0.6);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; outline: none; transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; }
        
        body {
            background: linear-gradient(to bottom, var(--bg-body-start) 0%, var(--bg-body-end) 100%);
            background-attachment: fixed;
            color: var(--text-main);
            padding-bottom: 40px;
            opacity: 0; 
            animation: fadeInPage 0.3s ease-out forwards;
            min-height: 100vh;
        }

        @keyframes fadeInPage { to { opacity: 1; } }
        @keyframes glideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .glide-entry { opacity: 0; animation: glideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        @keyframes shimmer { 0% { transform: translateX(-100%) skewX(-15deg); } 100% { transform: translateX(200%) skewX(-15deg); } }

        /* --- HEADER (FIXED & GLOBAL) --- */
        .header-container {
            position: fixed; top: 0; left: 0; width: 100%;
            background: var(--bg-body-start);
            z-index: 100;
            padding: 15px 15px 10px 15px; 
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: block;
            transition: background 0.3s ease;
        }
        
        .header-top-row { 
            display: flex; align-items: center; width: 100%;
            margin-bottom: 0px; 
            gap: 10px;
        }

        .back-btn { 
            padding: 0 16px; height: 42px;    
            background: var(--bg-card); 
            border-radius: 12px; 
            color: var(--accent-main); 
            font-weight: 600; font-size: 14px; 
            cursor: pointer; 
            display: none; 
            align-items: center; justify-content: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--tag-border);
            flex-shrink: 0; 
        }
        .back-btn:active { transform: scale(0.95); }
        
        .search-box { 
            flex: 1; min-width: 0; height: 42px; 
            background: var(--input-bg); 
            border: 1px solid var(--input-border); 
            border-radius: 12px; 
            padding: 0 15px; 
            color: var(--text-main); font-size: 15px; 
            box-shadow: var(--shadow);
        }
        .search-box:focus { border-color: var(--accent-main); }
        .search-box::placeholder { color: var(--text-sec); }

        .theme-toggle-btn {
            width: 42px; height: 42px;
            background: var(--toggle-bg);
            border-radius: 12px; 
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            font-size: 20px;
            border: 1px solid var(--tag-border);
            color: var(--toggle-icon);
            user-select: none;
            flex-shrink: 0;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.2s, background 0.3s;
        }
        .theme-toggle-btn:active { transform: scale(0.9); }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–µ–≥–æ–≤ */
        .tags-wrapper { 
            display: none; 
            gap: 8px; overflow-x: auto; 
            padding-top: 12px; padding-bottom: 5px; 
            scrollbar-width: none; 
        }
        .tags-wrapper::-webkit-scrollbar { display: none; }
        .tag { 
            white-space: nowrap; padding: 8px 16px; 
            background: var(--tag-bg); border: 1px solid var(--tag-border);
            border-radius: 30px; 
            font-size: 13px; font-weight: 600; color: var(--text-sec); 
            cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .tag.active { background: var(--accent-main); color: #fff; border-color: var(--accent-main); box-shadow: 0 4px 10px rgba(0, 122, 255, 0.3); }

        /* --- MAIN CONTENT --- */
        .main-content { padding: 85px 15px 20px 15px; }

        .special-cards-wrapper { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }

        .special-card {
            border-radius: 20px !important;
            padding: 25px 20px;
            cursor: pointer;
            position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
            transition: transform 0.1s;
            min-height: 100px;
            box-shadow: var(--shadow);
            border: none;
        }
        .special-card:active { transform: scale(0.98); }

        .card-action-blue {
            background: linear-gradient(135deg, #007AFF 0%, #0056b3 100%);
            color: white;
        }
        .card-action-blue::after {
            content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
            animation: shimmer 3.5s infinite cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .card-deep-blue {
            background: linear-gradient(135deg, #102A43 0%, #243B53 100%);
            color: white;
        }
        .card-deep-blue .sp-desc { color: #D9E2EC; }

        .sp-title {
            font-weight: 800; font-size: 19px;
            text-transform: uppercase; letter-spacing: 0.5px;
            margin-bottom: 6px; z-index: 2;
        }
        .sp-desc { font-size: 14px; opacity: 0.95; font-weight: 500; z-index: 2; }
        .sp-bg-icon {
            position: absolute; right: -10px; bottom: -20px;
            font-size: 90px; opacity: 0.12; transform: rotate(-15deg);
            z-index: 0; pointer-events: none;
        }

        /* --- HOME TILES --- */
        #homeTilesContainer { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(145px, 1fr)); 
            gap: 15px; margin-top: 10px;
        }
        
        .category-tile {
            background: var(--bg-card);
            border-radius: 20px !important;
            padding: 25px 20px; 
            cursor: pointer;
            position: relative; overflow: hidden; 
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 140px;
            box-shadow: var(--shadow);
            border: 1px solid transparent;
        }
        .category-tile:active { transform: scale(0.97); border-color: var(--accent-main); }
        .tile-icon { font-size: 32px; margin-bottom: 15px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        .tile-title { font-size: 15px; font-weight: 700; color: var(--text-main); line-height: 1.2; word-break: break-word; hyphens: auto; }
        .tile-count { font-size: 12px; color: var(--text-sec); margin-top: 8px; font-weight: 500; }

        /* --- LIST VIEW --- */
        #listViewContainer { display: none; }
        .section-header { 
            margin-top: 10px; margin-bottom: 15px; 
            display: flex; align-items: center; 
            color: var(--accent-deep); 
            font-weight: 800; font-size: 16px; 
            text-transform: uppercase; letter-spacing: 1px; 
        }
        .section-header::before { 
            content: ''; display: inline-block; 
            width: 4px; height: 18px; 
            background: var(--accent-main); 
            margin-right: 12px; border-radius: 4px; 
        }
        .posts-list { display: flex; flex-direction: column; gap: 12px; }
        .post-card { 
            background-color: var(--bg-card); 
            padding: 18px; 
            border-radius: 16px !important;
            cursor: pointer; 
            position: relative; overflow: hidden; 
            border: 1px solid transparent; 
            box-shadow: var(--shadow);
        }
        .post-card:active { border-color: var(--accent-main); opacity: 0.8; }
        .post-title { font-size: 15px; line-height: 1.5; font-weight: 600; color: var(--text-main); }
        
        .highlight { background: var(--highlight-bg); color: inherit; padding: 0 2px; border-radius: 4px; }

        /* --- BOTTOM SHEET --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0, 0.6); z-index: 500; opacity: 0; visibility: hidden; transition: opacity 0.2s; backdrop-filter: blur(4px); }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        
        .bottom-sheet { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background-color: var(--bg-card); 
            border-top-left-radius: 25px; border-top-right-radius: 25px; 
            padding: 25px 20px 45px 20px; 
            z-index: 600; 
            transform: translateY(100%); 
            transition: transform 0.35s cubic-bezier(0.15, 0.85, 0.25, 1.1);
            box-shadow: 0 -10px 50px rgba(0,0,0,0.3); 
            max-height: 85vh; overflow-y: auto; 
            border-top: 1px solid var(--tag-border);
        }
        .bottom-sheet.active { transform: translateY(0); }
        .sheet-handle { width: 40px; height: 5px; background: var(--sheet-handle); border-radius: 10px; margin: 0 auto 25px auto; }
        .sheet-category { color: var(--accent-main); font-size: 12px; font-weight: 700; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .sheet-title { font-size: 22px; font-weight: 800; line-height: 1.3; margin-bottom: 30px; color: var(--text-main); }
        
        .sheet-actions { display: flex; gap: 10px; margin-bottom: 30px; }

        .btn-main { 
            flex: 2; text-align: center; 
            background: var(--accent-main); color: #fff; 
            font-weight: 700; font-size: 16px; 
            padding: 16px; border-radius: 16px; border: none; 
            cursor: pointer; 
            transition: transform 0.1s; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .btn-main:active { transform: scale(0.97); }
        
        .btn-share {
            flex: 1; display: flex; align-items: center; justify-content: center;
            background: var(--bg-card); color: var(--accent-main);
            border: 2px solid var(--accent-main);
            border-radius: 16px; font-weight: 700; font-size: 16px;
            cursor: pointer; transition: background 0.1s;
        }
        .btn-share:active { background: var(--accent-light); }
        
        .related-section { border-top: 1px solid var(--tag-border); padding-top: 25px; }
        .related-header { font-size: 13px; color: var(--text-sec); margin-bottom: 15px; font-weight: 700; text-transform: uppercase; }
        
        .related-item { 
            background: var(--related-bg); 
            padding: 14px 18px; 
            border-radius: 12px; 
            margin-bottom: 10px; 
            font-size: 14px; color: var(--text-main); 
            display: flex; align-items: center; justify-content: space-between; 
            font-weight: 600; 
        }
        .related-item:active { background: var(--related-active); }
        .related-arrow { color: var(--accent-main); font-weight: bold; }
        
        .upsell-btn { 
            background: var(--accent-light); 
            border: 1px solid var(--tag-border); 
            color: var(--accent-main); 
            padding: 16px; border-radius: 16px; text-align: center; 
            font-size: 15px; font-weight: 700; 
            margin-top: 25px; width: 100%; 
            display: flex; align-items: center; justify-content: center; gap: 10px; 
        }
        .empty-state { text-align: center; color: var(--text-sec); margin-top: 60px; font-size: 15px; font-weight: 500; }
    </style>
</head>
<body>

    <div class="header-container" id="listHeader">
        <div class="header-top-row">
            <div class="back-btn" id="backToHomeBtn">‚Üê</div>
            <input type="text" id="searchInput" class="search-box" placeholder="–ü–æ–∏—Å–∫ —Å–∏–º–ø—Ç–æ–º–∞ –∏–ª–∏ —Ç–µ–º—ã...">
            <div class="theme-toggle-btn" id="headerThemeBtn">‚òÄÔ∏è</div>
        </div>
        <div class="tags-wrapper" id="tagsContainer"></div>
    </div>

    <div class="main-content">
        
        <div class="special-cards-wrapper" id="specialCardsWrapper">
            <div class="special-card card-action-blue glide-entry" id="bookingBtn" style="animation-delay: 0.05s;">
                <div class="sp-title">üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º</div>
                <div class="sp-desc">–ú–æ—Å–∫–≤–∞. –û—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∏ —Ç–µ—Ä–∞–ø–∏—è. –ñ–º–∏.</div>
                <div class="sp-bg-icon">ü©∫</div>
            </div>

            <div class="special-card card-deep-blue glide-entry" id="aboutBtn" style="animation-delay: 0.1s;">
                <div class="sp-title">üë®‚Äç‚öïÔ∏è –ë–æ—Ä–∏—Å –ï—Ä–æ—Ö–∏–Ω: –û–±–æ –º–Ω–µ</div>
                <div class="sp-desc">–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ, —Ü–µ–Ω—ã, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã.</div>
                <div class="sp-bg-icon">üéì</div>
            </div>
        </div>

        <div id="homeTilesContainer"></div>
        <div id="listViewContainer">
             <div class="posts-list" id="postsContainer"></div>
        </div>

    </div>

    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="bottom-sheet" id="postSheet">
        <div class="sheet-handle"></div>
        <div class="sheet-category" id="sheetCategory">–†–£–ë–†–ò–ö–ê</div>
        <div class="sheet-title" id="sheetTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</div>
        
        <div class="sheet-actions">
            <button class="btn-main" id="readBtn">–ß–ò–¢–ê–¢–¨ ‚û§</button>
            <button class="btn-share" id="shareBtn">üì§</button>
        </div>

        <div class="related-section">
            <div class="related-header">–¢–∞–∫–∂–µ –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ:</div>
            <div id="relatedContainer"></div>
        </div>
        <button class="upsell-btn" id="upsellBtn">üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º (Yclients)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const STATE_KEY = 'dr_erokhin_state_v9';
        const STATE_TTL = 15 * 60 * 1000;
        const BOOKING_URL = "https://n1100041.yclients.com";
        const ABOUT_CATEGORY_NAME = "üìã –û –í—Ä–∞—á–µ & –¶–µ–Ω—ã"; 
        const THEME_KEY = 'dr_erokhin_theme';

        let db = []; // –ë–∞–∑–∞ —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç–∞—è, –ø–æ–¥–≥—Ä—É–∑–∏–º
        const categoriesMap = new Map();
        const uniqueCategoriesList = [];

        // --- –õ–û–ì–ò–ö–ê –ó–ê–ì–†–£–ó–ö–ò ---
        async function initApp() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º JSON
                const response = await fetch('posts.json');
                if (!response.ok) throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É");
                
                db = await response.json();
                
                // –°—á–∏—Ç–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                calculateCategories();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º UI
                renderHomeTiles();
                restoreState();
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
                document.getElementById('homeTilesContainer').innerHTML = 
                    `<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.</div>`;
            }
        }

        function calculateCategories() {
            categoriesMap.clear();
            uniqueCategoriesList.length = 0; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤
            
            db.forEach(item => {
                const parts = item.c.split(' ');
                const icon = parts[0];
                const name = parts.slice(1).join(' ');
                if (!categoriesMap.has(item.c)) {
                    categoriesMap.set(item.c, { icon, name, full: item.c, count: 0 });
                }
                categoriesMap.get(item.c).count++;
            });
            uniqueCategoriesList.push(...Array.from(categoriesMap.values()));
        }

        // --- –õ–û–ì–ò–ö–ê –¢–ï–ú–´ ---
        const headerThemeBtn = document.getElementById('headerThemeBtn');
        const rootElement = document.documentElement;

        function applyTheme(theme) {
            const icon = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            if (theme === 'dark') {
                rootElement.setAttribute('data-theme', 'dark');
                tg.setHeaderColor('#0f172a');
                tg.setBackgroundColor('#0f172a');
            } else {
                rootElement.removeAttribute('data-theme');
                tg.setHeaderColor('#F0F4F8');
                tg.setBackgroundColor('#F0F4F8');
            }
            headerThemeBtn.innerText = icon;
            localStorage.setItem(THEME_KEY, theme);
        }

        const savedTheme = localStorage.getItem(THEME_KEY);
        if (savedTheme) {
            applyTheme(savedTheme);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            applyTheme('dark');
        } else {
            applyTheme('light');
        }

        function toggleTheme() {
            tg.HapticFeedback.impactOccurred('medium');
            const current = rootElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
        }

        headerThemeBtn.addEventListener('click', toggleTheme);

        
        let currentViewState = 'home';
        let currentCategory = null;
        let searchQuery = "";

        const listHeader = document.getElementById('listHeader');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        const homeTilesContainer = document.getElementById('homeTilesContainer');
        const listViewContainer = document.getElementById('listViewContainer');
        const postsContainer = document.getElementById('postsContainer');
        const searchInput = document.getElementById('searchInput');
        const tagsContainer = document.getElementById('tagsContainer');
        const mainContent = document.querySelector('.main-content');
        const specialCardsWrapper = document.getElementById('specialCardsWrapper');
        const bookingBtn = document.getElementById('bookingBtn');
        const aboutBtn = document.getElementById('aboutBtn');
        const shareBtn = document.getElementById('shareBtn');
        const readBtn = document.getElementById('readBtn');

        function saveState() {
            try {
                const state = { view: currentViewState, category: currentCategory, scroll: window.scrollY, search: searchQuery, ts: Date.now() };
                localStorage.setItem(STATE_KEY, JSON.stringify(state));
            } catch (e) {}
        }

        function restoreState() {
            try {
                const raw = localStorage.getItem(STATE_KEY);
                if (!raw) return;
                const state = JSON.parse(raw);
                if (Date.now() - state.ts > STATE_TTL) { localStorage.removeItem(STATE_KEY); return; }

                if (state.view === 'list') {
                    switchToList(state.category, false);
                    if (state.search) {
                        searchQuery = state.search;
                        searchInput.value = state.search;
                        filterAndRenderList(false);
                    }
                    setTimeout(() => window.scrollTo(0, state.scroll), 10);
                }
            } catch (e) {}
        }

        function switchToHome() {
            currentViewState = 'home';
            currentCategory = null;
            searchQuery = "";
            searchInput.value = "";
            
            backToHomeBtn.style.display = 'none';
            tagsContainer.style.display = 'none';
            listViewContainer.style.display = 'none';
            
            homeTilesContainer.style.display = 'grid';
            specialCardsWrapper.style.display = 'flex';
            
            window.scrollTo({ top: 0 });
            tg.HapticFeedback.impactOccurred('light');
            localStorage.removeItem(STATE_KEY);
        }

        function switchToList(category, animate = true) {
            currentViewState = 'list';
            currentCategory = category;
            
            backToHomeBtn.style.display = 'flex';
            tagsContainer.style.display = 'flex';
            
            homeTilesContainer.style.display = 'none';
            specialCardsWrapper.style.display = 'none';
            
            listViewContainer.style.display = 'block';
            
            renderTags();
            filterAndRenderList(animate);
            if(animate) window.scrollTo({ top: 0 });
        }

        backToHomeBtn.addEventListener('click', switchToHome);

        function renderHomeTiles() {
            homeTilesContainer.innerHTML = '';
            let animDelay = 0.15;
            uniqueCategoriesList.forEach(catData => {
                const tile = document.createElement('div');
                tile.className = 'category-tile glide-entry';
                tile.style.animationDelay = `${animDelay}s`;
                tile.innerHTML = `
                    <div class="tile-icon">${catData.icon}</div>
                    <div>
                        <div class="tile-title">${catData.name}</div>
                        <div class="tile-count">${catData.count} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                    </div>
                `;
                tile.onclick = () => {
                    tg.HapticFeedback.impactOccurred('medium');
                    switchToList(catData.full);
                };
                homeTilesContainer.appendChild(tile);
                animDelay += 0.05;
            });
        }

        function renderTags() {
            tagsContainer.innerHTML = '';
            const homeTag = document.createElement('div');
            homeTag.className = 'tag';
            homeTag.innerText = '–í—Å–µ';
            homeTag.onclick = () => {
                 currentCategory = null; 
                 renderTags();
                 filterAndRenderList(true);
            };
            if(currentCategory === null) homeTag.classList.add('active');
            tagsContainer.appendChild(homeTag);

            uniqueCategoriesList.forEach(catData => {
                const btn = document.createElement('div');
                btn.className = `tag ${catData.full === currentCategory ? 'active' : ''}`;
                btn.innerText = catData.name;
                btn.onclick = () => {
                    currentCategory = catData.full;
                    renderTags();
                    filterAndRenderList(true);
                    tg.HapticFeedback.impactOccurred('light');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                tagsContainer.appendChild(btn);
            });
        }

        function filterAndRenderList(animate = true) {
            postsContainer.innerHTML = '';
            let animationIndex = 0;
            const filtered = db.filter(item => {
                const catMatch = currentCategory ? item.c === currentCategory : true;
                const searchMatch = item.t.toLowerCase().includes(searchQuery.toLowerCase());
                return catMatch && searchMatch;
            });

            if (filtered.length === 0) {
                postsContainer.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 40px; margin-bottom: 10px;">ü§î</div>
                        <div>–ü–æ –∑–∞–ø—Ä–æ—Å—É "<b>${searchQuery}</b>" –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>
                        <div style="margin-top: 5px; opacity: 0.7; font-size: 13px;">–ù–æ —ç—Ç–æ –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –ª–∏—á–Ω–æ.</div>
                        <button class="btn-main" style="margin-top: 20px; font-size: 14px; padding: 12px; width: auto; display: inline-block;" onclick="tg.openLink('${BOOKING_URL}')">
                            –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–∞–∑–±–æ—Ä ‚û§
                        </button>
                    </div>`;
                return;
            }

            const header = document.createElement('div');
            header.className = animate ? 'section-header glide-entry' : 'section-header';
            if(animate) header.style.animationDelay = '0.05s';
            header.innerText = currentCategory ? currentCategory : (searchQuery ? `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: ${filtered.length}` : '–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã');
            postsContainer.appendChild(header);

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = animate ? 'post-card glide-entry' : 'post-card';
                if (animate) div.style.animationDelay = `${0.05 + (animationIndex * 0.03)}s`;
                
                let titleHtml = item.t;
                if (searchQuery) {
                    const regex = new RegExp(`(${searchQuery})`, 'gi');
                    titleHtml = item.t.replace(regex, '<span class="highlight">$1</span>');
                }
                
                div.innerHTML = `<div class="post-title">${titleHtml}</div>`;
                div.onclick = () => { openSheet(item); };
                postsContainer.appendChild(div);
                animationIndex++;
            });
        }

        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value;
            if (currentViewState === 'home' && searchQuery.length > 0) {
                switchToList(null, true);
            } 
            filterAndRenderList(true);
        });

        const modalOverlay = document.getElementById('modalOverlay');
        const postSheet = document.getElementById('postSheet');
        const sheetTitle = document.getElementById('sheetTitle');
        const sheetCategory = document.getElementById('sheetCategory');
        const relatedContainer = document.getElementById('relatedContainer');
        const upsellBtn = document.getElementById('upsellBtn');

        function openSheet(item) {
            tg.HapticFeedback.impactOccurred('medium');
            sheetTitle.innerText = item.t;
            const catIcon = item.c.split(' ')[0];
            sheetCategory.innerHTML = `<span style="font-size: 16px;">${catIcon}</span> ${item.c.substring(catIcon.length)}`;
            
            readBtn.onclick = () => {
                tg.HapticFeedback.impactOccurred('light');
                saveState();
                tg.openTelegramLink(item.u);
            };

            shareBtn.onclick = () => {
                tg.HapticFeedback.impactOccurred('light');
                const shareUrl = 'https://t.me/share/url?url=' + encodeURIComponent(item.u) + '&text=' + encodeURIComponent(item.t);
                tg.openTelegramLink(shareUrl);
            };
            
            upsellBtn.onclick = () => {
                tg.HapticFeedback.impactOccurred('light');
                saveState();
                tg.openLink(BOOKING_URL);
            }
            
            const related = db.filter(p => p.c === item.c && p.u !== item.u).sort(() => 0.5 - Math.random()).slice(0, 3);
            relatedContainer.innerHTML = '';
            if (related.length === 0) relatedContainer.innerHTML = '<div style="color: var(--text-sec); font-size:13px;">–ù–µ—Ç –ø–æ—Ö–æ–∂–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>';
            else {
                related.forEach(rel => {
                    const div = document.createElement('div');
                    div.className = 'related-item';
                    div.innerHTML = `<span>${rel.t}</span> <span class="related-arrow">‚Üí</span>`;
                    div.onclick = () => { openSheet(rel); };
                    relatedContainer.appendChild(div);
                });
            }
            modalOverlay.classList.add('active');
            postSheet.classList.add('active');
        }
        
        function closeSheet() { modalOverlay.classList.remove('active'); postSheet.classList.remove('active'); }
        modalOverlay.addEventListener('click', closeSheet);

        bookingBtn.addEventListener('click', () => {
            tg.HapticFeedback.impactOccurred('medium');
            tg.openLink(BOOKING_URL);
        });

        aboutBtn.addEventListener('click', () => {
            tg.HapticFeedback.impactOccurred('medium');
            switchToList(ABOUT_CATEGORY_NAME);
        });

        // –ó–∞–ø—É—Å–∫
        initApp();

    </script>
</body>
</html>
